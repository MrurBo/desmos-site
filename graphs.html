---
layout: default
title: Graph Browser
---

<div class="container mt-4">
    <h1 class="mb-4">Graph Browser</h1>
    
    <div class="row mb-4">
        <div class="col">
            <div class="input-group">
                <input type="text" id="searchInput" class="form-control" placeholder="Search graphs...">
                <button class="btn btn-outline-secondary" type="button" id="clearSearch">Clear</button>
            </div>
        </div>
        <div class="col-auto">
            <select id="tagFilter" class="form-select">
                <option value="">All Tags</option>
            </select>
        </div>
    </div>

    <div id="graphsContainer" class="row g-4">
        <!-- Graphs will be dynamically inserted here -->
    </div>
</div>

<template id="graphCardTemplate">    <div class="col-md-6 col-lg-4 graph-card">
        <div class="card h-100">
            <div class="calculator-preview" style="height: 200px;">
                <iframe class="w-100 h-100 border-0"></iframe>
            </div>
            <div class="card-body">
                <h5 class="card-title"></h5>
                <p class="card-text description"></p>
                <div class="tags mb-2"></div>
                <a class="btn btn-primary view-graph" target="_blank">Open in Desmos</a>
            </div>
        </div>
    </div>
</template>

<style>
    .tag-badge {
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
        cursor: pointer;
    }
    .calculator-preview {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0,0,0,.125);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let graphs = [];
    const graphsContainer = document.getElementById('graphsContainer');
    const searchInput = document.getElementById('searchInput');
    const tagFilter = document.getElementById('tagFilter');
    const clearSearch = document.getElementById('clearSearch');
    const template = document.getElementById('graphCardTemplate');    // Fetch graphs data    // Fetch both graphs and tags data
    Promise.all([
        fetch('{{ site.baseurl }}/graphs.json').then(response => response.json()),
        fetch('{{ site.baseurl }}/tags.json').then(response => response.json())
    ])
    .then(([graphsData, tagsData]) => {
        graphs = graphsData.graphs;
        
        // Sort tags by count (most used first)
        const sortedTags = tagsData.tags.sort((a, b) => b.count - a.count);
        
        // Populate tag filter with counts
        sortedTags.forEach(tag => {
            const option = document.createElement('option');
            option.value = tag.name;
            option.textContent = `${tag.name} (${tag.count})`;
            tagFilter.appendChild(option);
        });
            
            renderGraphs();
        });

    function renderGraphs(searchTerm = '', tagFilter = '') {
        graphsContainer.innerHTML = '';
        
        const filteredGraphs = graphs.filter(graph => {
            const matchesSearch = !searchTerm || 
                graph.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                graph.description.toLowerCase().includes(searchTerm.toLowerCase());
            const matchesTag = !tagFilter || graph.tags.includes(tagFilter);
            return matchesSearch && matchesTag;
        });

        filteredGraphs.forEach(graph => {
            const clone = template.content.cloneNode(true);
            
            const card = clone.querySelector('.graph-card');
            const title = clone.querySelector('.card-title');
            const description = clone.querySelector('.card-text');
            const tagsContainer = clone.querySelector('.tags');
            const previewContainer = clone.querySelector('.calculator-preview');
            
            title.textContent = graph.title;
            description.textContent = graph.description;
              // Add tags with descriptions from tags data
            graph.tags.forEach(tagName => {
                const badge = document.createElement('span');
                badge.className = 'badge bg-secondary tag-badge';
                badge.textContent = tagName;
                
                // Find tag info from tags.json
                const tagInfo = tagsData.tags.find(t => t.name === tagName);
                if (tagInfo && tagInfo.description) {
                    badge.title = tagInfo.description; // Add tooltip
                    badge.setAttribute('data-bs-toggle', 'tooltip');
                }
                
                badge.addEventListener('click', () => {
                    tagFilter.value = tagName;
                    renderGraphs(searchInput.value, tagName);
                });
                tagsContainer.appendChild(badge);
            });// Set up iframe preview with disabled interaction
            const iframe = previewContainer.querySelector('iframe');
            const embedParams = [
                'embed',
                'settingsMenu=0',
                'zoomButtons=0',
                'expressions=0',
                'keypad=0',
                'lockViewport=1',
                'hideHorizontal=1',
                'hideVertical=1',
                'disableMouseInteraction=1'
            ].join('&');
            iframe.src = `${graph.graphLink}?${embedParams}`;

            // Set up view button
            const viewButton = clone.querySelector('.view-graph');
            viewButton.href = graph.graphLink;
              graphsContainer.appendChild(clone);
        });
        
        // Initialize tooltips
        const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltips.forEach(tooltip => {
            new bootstrap.Tooltip(tooltip);
        });
    }

    // Event listeners
    searchInput.addEventListener('input', () => {
        renderGraphs(searchInput.value, tagFilter.value);
    });

    tagFilter.addEventListener('change', () => {
        renderGraphs(searchInput.value, tagFilter.value);
    });

    clearSearch.addEventListener('click', () => {
        searchInput.value = '';
        tagFilter.value = '';
        renderGraphs();
    });
});
</script>